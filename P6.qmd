---
title: "Project 6"
author: "Brandy Carr"
format: 
  html:
    linkcolor: "#037968"
    highlight-style: highlight.theme
    grid: 
      sidebar-width: 0px
      body-width: 1100px
      margin-width: 0px
    self-contained: true
    echo: true
    message: false
    warning: false
    error: true 
editor: source
---

<head>

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Quicksand">

<style>

  details>summary {
    color: #FA962D !important;
    font-size: 0.8rem !important;
    font-family: Quicksand !important;
  }

</style>

</head>


**This week you will be analyzing data from the Jackson Heart Study (JHS). You can find the data in the Week 1 module on Canvas. For full credit, you must include all code chunks and R output backing up your responses. Remember to set your seed in all problems for reproducibility purposes.**

```{r}
library(tidyverse)
library(kableExtra)
library(tidymodels)

JHS <- haven::read_sas("analysis1.sas7bdat")
VARS <- read.csv("variables.csv")
```

</br>

**1. Use leave-one-out cross validation to determine which model fits better:**

::: {.panel-tabset}

## Variables

```{r}
#| code-summary: "R Code"
#| code-fold: true
# Subset Data
JHS_1 <- 
  na.omit(select(JHS, sbp, age, HSgrad, diab3cat, BMI)) %>% 
    mutate(obs = row_number()) %>% 
    relocate(obs)

# Subset Variables
VARS_1 <- filter(VARS, VAR %in% c("sbp","age","HSgrad","diab3cat","BMI"))

# Factor Variables
JHS_1 <- 
  JHS_1 %>%
    mutate(diab3cat = factor(diab3cat, 
                             levels=c(0,1,2), 
                             labels=c("Non-Diabetic","Pre-Diabetic","Diabetic")),
           HSgrad = factor(HSgrad, 
                           levels=c(0,1), 
                           labels=c("NO","YES")))

# HTML Table
kable(VARS_1, align=c("l","l"))
```

## Split

```{r}
set.seed(6232)
split_1 <- initial_split(JHS_1, prop=0.5)
train_1 <- training(split_1)
test_1 <- testing(split_1)
kable(head(train_1), align=c("l",rep("c",5)))
```

## 1a

**Systolic blood pressure (*sbp*; mmHg) as a function of age (*age*; years), education (*HSgrad*; 0=no, 1=yes), diabetic status (*diab3cat*; 0=non-diabetic, 1=pre-diabetic, 2=diabetic), body mass index (*BMI*, kg/m2), the interaction between diabetic status and age, and the interaction between diabetic status and education.**

```{r}
m_1a <- glm(sbp ~ age + HSgrad + diab3cat + BMI + diab3cat:age + diab3cat:HSgrad, data=train_1)
summary(m_1a)
```

## 1b

**Systolic blood pressure (*sbp*; mmHg) as a function of age (*age*; years), education (*HSgrad*; 0=no, 1=yes), diabetic status (*diab3cat*; 0=non-diabetic, 1=pre-diabetic, 2=diabetic), body mass index (*bmi*, kg/m2).**

```{r}
m_1b <- glm(sbp ~ age + HSgrad + diab3cat + BMI, data=train_1)
summary(m_1b)
```

## Results

```{r}
#| code-summary: "R Code"
#| code-fold: true
#| results: hold
# Predict
test_1 <- test_1 %>% 
              mutate(yhat_m_1a=predict(m_1a, newdata=test_1),
                     yhat_m_1b=predict(m_1b, newdata=test_1)) %>%
              mutate(sqErr_m_1a=(yhat_m_1a - sbp)^2,
                     sqErr_m_1b=(yhat_m_1b - sbp)^2) %>%
              relocate(obs, sbp, yhat_m_1a, sqErr_m_1a, yhat_m_1b, sqErr_m_1b)

kable(head(test_1), align=c("l",rep("c",9)))

# MSE
MSE_1a = mean(test_1$sqErr_m_1a, na.rm=T); noquote(paste0("MSE of Model 1a: ", MSE_1a))
MSE_1b = mean(test_1$sqErr_m_1b, na.rm=T); noquote(paste0("MSE of Model 1b: ", MSE_1b))

# Conclusion
if(MSE_1a > MSE_1b){
  noquote("Of the two candidate models, the model excluding the interaction terms (m_1b) gives the lowest MSE.")
} else if(MSE_1a < MSE_1b){
  noquote("Of the two candidate models, the model including the interaction terms (m_1a) gives the lowest MSE.")
} else {
  noquote("MSE is the same for both models.")
}
```

:::

</br>

**2. Consider the following model: diabetic status (*Diabetes*; 0=non-diabetic, 1=diabetic) as a function of age (*age*; years), weight (*weight*; kg), hypertension status (*HTN*; 0=normotensive, 1=hypertensive), health status as indicated by high density lipoproteins (*hdl3cat*; 0=poor health, 1=intermediate health, 2=ideal health), the interaction between weight and hypertension status, the interaction between weight and age, and the interaction between weight and health status as indicated by high density lipoproteins.**

```{r}

```

<!-- You want to time how long each CV below takes. hint: https://rdrr.io/cran/tictoc/man/tic.html -->

**2a. Perform 2-fold cross validation.**

```{r}

```

**2b. Perform 5-fold cross validation.**

```{r}

```

**2c. Perform 10-fold cross validation.**

```{r}

```

**2d. Perform 25-fold cross validation.**

```{r}

```

**2e. Perform 50-fold cross validation.**

```{r}

```

**2f. Perform 100-fold cross validation.**

```{r}

```

**2g. What did you observe, if anything, about the CV values?**

**2h. What did you observe, if anything, about the processing time?**

**3. Use 25-fold cross validation to determine which model fits better:**

**3a. Modeling the number of ideal health indicators (use blood pressure (*idealHealthBP*; 1=ideal health, 0=not ideal health), smoking status (*idealHealthSMK*; 1=ideal health, 0=not ideal health), diabetes (*idealHealthDM*; 1=ideal health, 0=not ideal health), diet  (idealHealthNutrition; 1=ideal health, 0=not ideal health), physical activity (*idealHealthPA*; 1=ideal health, 0=not ideal health), obesity  (*idealHealthBMI*; 1=ideal health, 0=not ideal health), and high cholesterol  (*idealHealthChol*; 1=ideal health, 0=not ideal health)) as a function of age (*age*; years), health insurance (*PrivatePublicIns*; 0=uninsured, 1=private insurance only, 2=public insurance only, 3=private and public insurances), education status (*HSgrad*; 0=did not graduate high school, 1=graduated high school), and the interaction between age and health insurance.**

```{r}

```

**3b. Modeling the number of ideal health indicators (use blood pressure (*idealHealthBP*; 1=ideal health, 0=not ideal health), smoking status (*idealHealthSMK*; 1=ideal health, 0=not ideal health), diabetes (*idealHealthDM*; 1=ideal health, 0=not ideal health), diet  (idealHealthNutrition; 1=ideal health, 0=not ideal health), physical activity (*idealHealthPA*; 1=ideal health, 0=not ideal health), obesity  (*idealHealthBMI*; 1=ideal health, 0=not ideal health), and high cholesterol  (*idealHealthChol*; 1=ideal health, 0=not ideal health)) as a function of age (*age*; years), health insurance (*PrivatePublicIns*; 0=uninsured, 1=private insurance only, 2=public insurance only, 3=private and public insurances), education status (*HSgrad*; 0=did not graduate high school, 1=graduated high school).**

```{r}

```

**4. Required for graduate students / extra credit for undergraduate students: this is a challenge question! If you cannot figure it out, please document the research you performed when searching for the answer and what you tried in terms of R code. Use leave-one-out cross validation to determine which model is better:**

**4a. Model diabetic status (*diab3cat*; 0=non-diabetic, 1=pre-diabetic, 2=diabetic) as a function of age (*age*; years), weight (*weight*; kg), hypertension (*HTN*; 1=yes, 0=no), high density lipoprotein (*hdl3cat*; 0=poor health, 1=intermediate health, 2=ideal health), the interaction between high density lipoprotein and age, and the interaction between weight and age.**

```{r}

```

**4b. Model diabetic status (*diab3cat*; 0=non-diabetic, 1=pre-diabetic, 2=diabetic) as a function of age (*age*; years), weight (*weight*; kg), hypertension (*HTN*; 1=yes, 0=no), and high density lipoprotein (*hdl3cat*; 0=poor health, 1=intermediate health, 2=ideal health).**

```{r}

```

**5. Required for graduate students / extra credit for undergraduate students: Pick the results from either Q1 or Q3 to write a summary paragraph for. This paragraph should outline the methodology + results and be readable for your supervisor (not a statistician or data scientist).**
